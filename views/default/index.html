{{extend 'layout.html'}}

{{block head}}

<script src="{{=URL('static', 'js/vue.js')}}"></script>
<script>
  var tracks_url = "{{=URL('api', 'get_tracks', user_signature=True, hash_vars=False)}}";
  var add_track_url = "{{=URL('api', 'add_track', user_signature=True)}}";
  var del_track_url = "{{=URL('api', 'del_track', user_signature=True)}}";
  var upload_url = "{{=URL('api', 'upload_track', user_signature=True)}}";
  var play_url = "{{=URL('api', 'play_track')}}";
  var inc_plays_url = "{{=URL('api', 'inc_plays', user_signature=True)}}";
  var get_insertion_id_url = "{{=URL('api', 'get_insertion_id', user_signature=True)}}";
  var cleanup_url = "{{=URL('api', 'cleanup', user_signature=True)}}";
</script>

<script src="{{=URL('static', 'js/dropzone.js')}}"></script>

<script>
$(function() {
  Dropzone.options.fileUploader = {
    maxFilesize: 40, // MB
    url: upload_url,
    addRemoveLinks: false,
    parallelUploads: 1,
    acceptedFiles: 'audio/*',
    createImageThumbnails: false,
    init: function() {
      this.on("addedfile", function() {
        if (this.files.length > 1) {
          this.removeFile(this.files[0]);
        }
      });
      this.on("success", function(file, response) {
          APP.upload_complete(response);
          this.removeAllFiles();
      })
    }
  }
});
</script>

{{end}}

<div class="main_content">

  <!-- Dropzone uploader. This unfortunately cannot go into the Vue div -->
  <div id="uploader_div" style="display:none">
    <form action="" class="dropzone dz-clickable" id="file-uploader">
      <div class="dz-message">
        Drop files here to upload them, or click to select them.
      </div>
    </form>
  </div>

  <div id="vue-div" class="display:none">
    <!-- Your code goes here.  Remember to call $("#vue-div").show() once you get the data for the first time. -->


  </div>

</div>

<script src="{{=URL('static', 'js/default_index.js')}}"></script>
